#!/bin/sh

# This loop will update the playerctl statusbar module whenever a command
# changes the music player's status. playerctl must be running on X's start for
# this to work.

# Start mpd-mpris if it's not already running
until pidof -q mpd-mpris; do
    sleep 1
    setsid -f mpd-mpris
done

# Start playerctld if it's not already running
until pidof -q playerctld; do
    sleep 1
    setsid -f playerctld
done

format="{{title}} {{artist}} {{emoji(status)}}"

playerctl -i firefox metadata --format "$format" --follow | while read -r line; do
    kill -45 "$(pidof "${STATUSBAR:-dwmblocks}")"
done
